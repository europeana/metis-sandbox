# Spring Actuator Info App
info:
  app:
    title: &appTitle Metis Sandbox
    description: Metis Sandbox to process Datasets
    version: 1.0.0
    repository: https://github.com/europeana/metis-sandbox
    contact:
      name: Europeana Foundation
      email: info@europeana.eu
      url: www.europeana.eu

# Spring Actuator Management (https://docs.spring.io/spring-boot/docs/current/actuator-api/htmlsingle/)
management:
  endpoints:
    web:
      exposure:
        include: ["health", "info", "loggers", "metrics", "scheduledtasks", "beans"]
    access:
      default: read_only
  endpoint:
    health:
      access: read_only
    info:
      access: read_only
    loggers:
      access: read_only
    metrics:
      access: read_only
    scheduledtasks:
      access: read_only
    beans:
      access: read_only
  ## Enables info.app properties
  info:
    env:
      enabled: true

# Truststore
truststore:
  path:
  password:

# Elastic APM
elastic:
  apm:
    enabled: true
    recording: true
    instrument: true
    service_name: metis-sandbox-rest-local
    server_url: http://localhost:8200
    environment: local
    application_packages: org.europeana,eu.europeana.metis.sandbox
    log_level: ERROR
    capture_body: all
    capture_headers: true
    metrics_interval: 5s

# Spring
spring:
  autoconfigure:
    exclude:
      - org.springframework.boot.autoconfigure.mongo.MongoAutoConfiguration
      - org.springframework.boot.autoconfigure.data.mongo.MongoDataAutoConfiguration
  application:
    name: *appTitle
  servlet:
    multipart:
      max-file-size: 5MB
      max-request-size: 5MB
  security:
    oauth2:
      resourceserver:
        jwt:
          jwk-set-uri: http://localhost:7080/realms/europeana/protocol/openid-connect/certs
  ## Spring Data
  datasource:
    jdbcUrl:
    driverClassName:
    username:
    password:
    maximumPoolSize: 10           # this is the default we make it explicit in the config.
    leakDetectionThreshold: 5000  # five second should be enough
  jpa:
    open-in-view: false

# Metis Sandbox
sandbox:
  cors:
    mapping: '*'
  rate-limit:
    bandwidth:
      capacity: 20
      time: 3600 # in seconds
  debias:
    url: http://localhost:8081/metis-debias
    connectTimeout: 300
    requestTimeout: 300
  dataset:
    clean:
      frequency: 0 0 0 * * ? # At 00:00:00am every day
      days-to-preserve: 7
    max-size: 1000
    creation:
      threads:
        core-pool-size: 10
        max-pool-size: 40
        thread-prefix: sandbox-
  metrics:
    frequency: '*/5 * * * * *' # every five seconds.
  validation:
    edm-sorter-url: http://ftp.eanadev.org/schema_zips/edm_sorter.xsl
    executor:
      pool-size: 10
    predefinedSchemas:
      EDM-INTERNAL:
        url: http://ftp.eanadev.org/schema_zips/europeana_schemas-20220809.zip
        rootLocation: EDM-INTERNAL.xsd
        schematronLocation: schematron/schematron-internal.xsl
      EDM-EXTERNAL:
        url: http://ftp.eanadev.org/schema_zips/europeana_schemas-20220809.zip
        rootLocation: EDM.xsd
        schematronLocation: schematron/schematron.xsl
  transformation:
    xslt-url: https://metis-core-rest.test.eanadev.org/datasets/xslt/default
    xslt-update-frequency: 0 0 * * * * # 0 0 * * * * = every hour of every day
  enrichment:
    dereference-url: https://metis-dereference-rest.test.eanadev.org
    enrichment-properties:
      entity-management-url: https://entity-management-production.eanadev.org/entity
      entity-api-url: https://entity-api-v2-production.eanadev.org/entity
      entity-api-token-endpoint: https://auth.europeana.eu/auth/realms/europeana/protocol/openid-connect/token
      entity-api-grant-params: metis-enrichment&client_secret=&grant_type=client_credentials
  publish:
    mongo:
      application-name: metis-sandbox-local
      db:
      hosts:
      ports:
      authentication-db:
      username:
      password:
      ssl-enable: false
    solr:
      hosts:
      zookeeper:
        hosts:
        ports:
        chroot:
        default:
          collection:
        timeout: 10
  s3:
    access-key:
    secret-key:
    endpoint:
    signing-region:
    thumbnails-bucket:
  portal:
    publish:
      dataset-base-url: "http://metis-test"
      record-base-url: "http://metis-test/item"

